dayly_analysis_task:
  description: |
    **Anchor your timeline** to the given date {date}, which is a {weekday}.
    Ignore any knowledge about today's real date.
    
    **STEP 1 - Gather Data Sequentially:**
    Call each of these tools one at a time (do not call multiple tools in the same response):
    1. Call athlete_lookup tool with athlete={athlete} to get profile information
    2. Call daily_workout_reader tool with athlete={athlete}, start_date={date}, end_date={date} to read workout data
    3. Call daily_self_assessment_reader tool with athlete={athlete}, start_date={date}, end_date={date} to read self-assessment
    4. Call athlete_plan_lookup tool with athlete={athlete}, start_date={date}, end_date={date} to check planned workouts
    
    Important: Wait for each tool to return results before calling the next tool. Do not confuse planned workouts with completed workouts.

    **STEP 2 - Check Data Availability:**
    After gathering all tool results, check if there is workout data or self-assessments for {date}.
    If there is no workout data AND no self-assessments, output only:
    "No workout data available for {athlete} on {date}."
    
    You may proceed if there is at least one workout or self-assessment present, but explicitly state any missing data.
    Do not attempt to infer or invent activity details if data is missing.

    **STEP 3 - Analyze Data (when data is present):**
    First, provide a **Daily Summary** (maximum 150 words):
    - Key highlight of the day
    - Most important risk or achievement
    - Primary recommendation for head coach

    Then, for each workout, provide a structured analysis containing:

    1. **Executive Summary**: 2-3 sentences with the most important takeaway for the coach
    2. **Risk & Alert Flags**: Critical signs of overload, under-recovery, or injury risks (if any)
    3. **Coach Recommendations**: Specific, actionable adjustments for upcoming sessions
    4. **Session Name**: Use the athlete's original session name if available, otherwise use filename
    5. **Session Overview**: Brief technical description of workout type and structure
    6. **Quantitative Summary**: Key performance metrics with relevant comparisons
    7. **Qualitative Assessment**: Interpretation of effort, load, zones, pacing, execution
    8. **Progress Indicators**: How this session fits into overall training progression

    **Length Guidelines:**
    - Daily Summary: max 150 words
    - Executive Summary per workout: max 50 words
    - Risk & Alert Flags: only include if materially significant
    - Total report: aim for 400-600 words for single workout day, 600-800 for multiple workouts

    **Data Interpretation Guidelines:**
    - Focus only on relevant, context-appropriate observations for the recorded sport type
    - Ignore minor data spikes or dropouts in sensor streams unless they dominate large portions of the file
    - For cycling: cadence is in RPM, power values compared to FTP
    - For running: cadence is in steps per minute (SPM); do not confuse with cycling cadence
    - Running "power" from GPS watch/foot pod is not directly comparable to cycling power; comment only in running context
    - Ignore one-off abnormal values at activity start (low power/cadence during GPS lock-on, etc.)
    - Flag genuine anomalies only if they materially affect interpretation of the session

    **Workout Prioritization:**
    When multiple activities are present:
    1. Analyze planned/key training sessions in full detail first
    2. Briefly note commute/transport activities at the end (one sentence unless unusually significant)
    3. If more than 3 activities, summarize non-training activities collectively

  expected_output: |
    If no data is available for {date}:
    "No workout data available for {athlete} on {date}."
    
    If data is available, provide a report structured as follows:
    
    **DAILY SUMMARY** (max 150 words)
    - Key highlight and primary recommendation
    
    **WORKOUT ANALYSES** (in order of training importance)
    For each significant workout:
    - Executive Summary (most important takeaway)
    - Risk & Alert Flags (if present)
    - Coach Recommendations
    - Session details (name, overview, metrics, assessment, progress)
    
    **SECONDARY ACTIVITIES** (brief note only)
    
    Use precise, analytical language. Prioritize actionable insights over comprehensive data reporting.
  markdown: true
  output_file: "{output_dir}/{date}_details.md"

daily_feedback_task:
  description: |
    **Anchor your timeline** to the given date {date}, which is a {weekday}.
    Ignore any knowledge about today's real date.
    
    **STEP 1 - Check QA Validation:**
    First, check the QA validation result from the previous task:
    - If the result is "INVALID_ANALYSIS" or "HALLUCINATION_DETECTED", output: "Unable to provide feedback due to data quality issues. Please check workout data and try again." and STOP.
    - If the validation passed, proceed with the validated analysis report.
    
    **STEP 2 - Check Data Availability:**
    If no analysis report or workouts exist for {date}, output: "No workout data is available for {date}." and STOP.
    
    **STEP 3 - Gather Information:**
    - Use athlete_lookup to get athlete profile and preferred language
    - Use daily_self_assessment_reader for {date} self-assessment
    - Use athlete_plan_lookup for planned workouts on {date}
    
    **STEP 4 - Create Feedback:**
    Write a casual, conversational coaching message (100-150 words MAX) in English like you're talking directly to the athlete:
    
    **Style Requirements:**
    - Write like a friendly, supportive coach having a conversation
    - NO headers, bullet points, or formal structure
    - Use simple paragraphs, like you're texting or chatting
    - Be encouraging but genuine, not overly enthusiastic
    - Keep it under 150 words - be concise!
    
    **Content Focus:**
    - Lead with acknowledgment of the main planned workout execution
    - Give secondary activities brief, positive mention (unless they were genuinely problematic)
    - Focus feedback on what went well and what to work on next
    
    **Content Requirements:**
    1. Quick acknowledgement of today's effort
    2. 1-2 positive things from the workout
    3. 1 area to improve (phrased positively)
    4. What to focus on tomorrow
    5. Brief motivational ending

  expected_output: |
    If QA validation failed: "Unable to provide feedback due to data quality issues. Please check workout data and try again."
    If no data exists: "No workout data is available for {date}."
    
    Otherwise: A casual, conversational message (100-150 words MAX) in plain English.
    NO headers, bullet points, or formal structure. Write like a friendly coach talking directly to the athlete.
    
  markdown: true
  output_file: "{output_dir}/{date}_feedback_en.md"

translate_task:
  description: |
    **Date: {date} ({weekday})**
    
    Create a natural, fluent version of the English coaching feedback in {preferred_language}.
    
    **Translation Style:**
    - Focus on natural expression in {preferred_language}, NOT word-by-word translation
    - Use idiomatic expressions and phrasing that sounds native
    - Adapt the tone to what feels natural in {preferred_language} culture
    - Keep the same casual, supportive coaching spirit
    
    **Requirements:**
    - Preserve all sports metrics and technical data exactly
    - Keep the same message and content, but express it naturally
    - Make it sound like it was originally written by a native {preferred_language} speaker
    
  expected_output: |
    A natural, fluent version in {preferred_language} that sounds like it was originally written by a native speaker.
    Should feel natural and idiomatic, not like a translation. Preserve all technical data and metrics exactly.
    
  output_file: "{output_dir}/{date}_feedback.md"

long_term_feedback_task:
  description: |
    **Anchor your timeline** to the given date {date}, which is a {weekday}.
    Ignore any knowledge about today's real date.
    
    Using the provided technical analysis reports and planned workouts, create a long-term feedback message for athlete {athlete}.
    Find all analysis feedback for athlete {athlete} from the past {days_history} days up to and including {date}.
    Also, find all planned workouts for the upcoming {days_ahead} days starting from {date}.

    Using data on the athlete's training load and execution over the past {days_history} days,
    along with a list of planned workouts for the upcoming {days_ahead} days,
    create a clear, constructive, and motivating feedback message that addresses long-term progression.
    You should obtain the athlete's profile, get analysis history and upcoming training plan from the relevant tools.

    Guidelines:
    - Use only the workouts provided in the historical and planned data; do not invent or assume missing information.
    - Evaluate recent load metrics (e.g., total training time, TSS, intensity distribution, key sessions completed).
    - Identify positive patterns or improvements over time.
    - Highlight sustained issues or potential risks (e.g., overtraining signs, neglected training zones).
    - Tie recommendations directly to the upcoming planned sessions.
    - Keep suggestions relevant and actionable inside the given forward_period.
    - Avoid deep technical details unless they affect the overall strategy.

  expected_output: |
    A well-structured message in the athlete's preferred language containing:
    1. Short opening acknowledgement of recent efforts.
    2. 2–3 key observations from recent training (both positives and concerns).
    3. Evaluation of readiness or focus going into the next planned period.
    4. 1–2 specific recommendations for upcoming sessions (adjustments or emphasis).
    5. Short closing motivation.
    Length ~150–225 words

    A short appendix, limited to 2-3 sections going in more detail on the given specific recommendations. Give references to specific past sessions, to 
    relevant literature or training principles.

  markdown: true
  output_file: "{output_dir}/{date}_feedback.md"

long_term_analysis_task:
  description: |
      **Anchor your timeline** to the given date {date}, which is a {weekday}.
      Ignore any knowledge about today's real date.
      
      **STEP 1 - Gather Data:**
      Use available tools to obtain all workout data for athlete {athlete} for the past {days_history} days up to and including {date}.

      **STEP 2 - Analyze Training Load and Execution:**
      Analyze the period holistically to provide insights for long-term coaching decisions:
      
      1. **Metric Selection**: Decide which metrics or patterns are most relevant in this context
      2. **Progress Indicators**: Identify clear indicators of improvement (fitness, consistency, skill, technique, etc.)
      3. **Risk Assessment**: Identify warnings such as fatigue accumulation, training imbalance, or missed training types
      4. **Focus Areas**: Pinpoint specific themes or areas the Head Coach should address with the athlete
      5. **Pattern Recognition**: Look for trends across workouts, not just individual sessions
      
      **Analysis Guidelines:**
      - Ignore irrelevant minor anomalies or technical oddities unless they materially change interpretation
      - Consider context: training phase, athlete goals, and recent self-assessments
      - Balance quantitative metrics with qualitative patterns
      - Provide actionable insights, not just data summaries

  expected_output: |
    A structured professional report in English containing:
    
    1. **Period Summary**: Overview of training volume, intensity distribution, and key sessions completed
    2. **Progress Indicators**: Specific improvements observed in fitness, consistency, skill, or execution quality
    3. **Risk & Warning Signs**: Fatigue markers, imbalances, or concerning patterns requiring attention
    4. **Recommended Focus Areas**: Specific themes or topics for the Head Coach to discuss with the athlete
    
    Avoid unrelated technical detail. Focus on insights that inform coaching decisions.

  markdown: true
  output_file: "{output_dir}/{date}_analysis.md"

plan_suggestion_task:
  description: |
    **Anchor your timeline** to the given date {date}, which is a {weekday}.
    Ignore any knowledge about today's real date.
    
    Check if athlete {athlete} has sufficient upcoming workout days planned and suggest new training plans if needed.
    
    Use athlete_plan_lookup to check upcoming workouts for the next {days_ahead} days starting from {date}.
    If there are {threshold} or fewer workout days planned, analyze historical training patterns and suggest new workouts.
    The existing plan may contain markes such as "Unavailable" or "Partial unavailable" that indicate days where
    the athlete cannot train as usual. Take these into account when suggesting new workouts.

    Also use the self_assessments_tool to check for any recent self-assessments that might indicate fatigue, injury, or 
    other factors affecting training capacity. Recent illness, injuries or fatigue should be considered when suggesting new workouts.
    
    **Process:**
    1. Check upcoming planned workouts for {days_ahead} days starting from {date}
    2. Count the number of days with planned workouts
    3. If <= {threshold} workout days are planned:
       - Use athlete_plan_lookup to get historical training patterns from past {lookback_days} days
       - Use athlete_reader to get athlete profile information
       - Use long_time_analysis_loader to get the latest long-term analysis insights
       - Analyze training patterns, intensity distribution, and progression needs
       - Suggest new workouts in the same format as plans.yaml
    4. If > {threshold} workout days are planned, confirm sufficient planning exists
    
    **Guidelines for suggestions:**
    - Base suggestions on historical training patterns and progression
    - Incorporate insights from the latest long-term analysis if available
    - Maintain appropriate training load and intensity distribution
    - Consider athlete's goals and current fitness level
    - Follow established periodization principles
    - Suggest workouts in the exact format used in plans.yaml (date: activities list)
    - Fill gaps to ensure adequate training stimulus while avoiding overload
    - Commutes should not be suggested as workouts. Commutes will be recorded every day independently 
      and will be unnessecary noize in the plan.
    - Commutes should be counted towarads the total training load as 35 hrTSS a day.
    
  expected_output: |
    If sufficient workouts are planned (> {threshold} days):
    "Training plan check completed. {athlete} has adequate workouts planned for the next {days_ahead} days."
    
    If insufficient workouts are planned (<= {threshold} days):
    A structured report containing:
    1. Current planning status (number of days with workouts vs threshold)
    2. Analysis of recent training patterns and athlete profile
    3. Suggested new workouts in plans.yaml format:
       ```
       d2025-MM-DD:
         - Activity description with duration/intensity
         - Additional activity if needed
       ```
    4. Rationale for each suggested workout based on training principles
    5. Integration recommendations for the suggested workouts
    
  markdown: true
  output_file: "{output_dir}/{date}_plan_suggestion.md"


validate_analysis_task:
  description: |
    Review the provided analysis report against workout data, planned workouts, the athlete's self-assessments, and domain knowledge rules.
    Use the tools to obtain all relevant data for athlete {athlete} on {date}.
    
    Validation criteria:
    1. Format:
        - Contains a clear summary of the day's workouts.
        - Contains relevant observations based ONLY on the provided data.
        - Avoids irrelevant anomalies, minor spikes, or technical noise unless it materially affects interpretation.
    2. Factual accuracy:
        - All metrics, events, and details must match the provided workout data.
        - No invented values, fabricated events, or inferred long-term trends without supporting data.
        - Adheres to domain knowledge reject/accept rules (e.g., HRV thresholds, commuting detection, strength training data handling).
    3. Context relevance:
        - Feedback and observations must relate strictly to the given date.
        - No generic "best practice" coaching advice without a direct tie to observed data.

    If VALID:
      - Output the original analysis report unchanged.

    If INVALID (format or factual issues):
      - Output "INVALID_ANALYSIS".

    If any detail clearly contradicts provided data or invents unsupported facts:
      - Output "HALLUCINATION_DETECTED".

  expected_output: |
    One of:
    - The original analysis text (if valid and accurate)
    - "INVALID_ANALYSIS" (if wrong format or not based on data)
    - "HALLUCINATION_DETECTED" (if invented/false content detected)

  markdown: true
  output_file: "{output_dir}/{date}_qa.md"
